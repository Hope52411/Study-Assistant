<div class="container mt-4 animate-fade">
  <!-- Top navigation: Title and Logout Button -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-white fw-bold">My Plans</h1>
    <% if user_signed_in? %>
      <div class="d-flex align-items-center">
        <!-- Display current user's email and logout button -->
        <span class="text-light me-3"><%= current_user.email %></span>
        <%= button_to 'Log out', destroy_user_session_path, method: :delete, data: { confirm: 'Are you sure to log out?' }, class: 'btn btn-warning btn-lg shadow-sm animate-fade' %>
      </div>
    <% end %>
  </div>

  <!-- Search Bar -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <%= form_with url: plans_path, method: :get, local: true, class: "row g-3" do |f| %>
        <div class="col-auto">
          <%= f.label :query, "Search Plans:", class: "form-label fw-bold text-dark" %>
        </div>
        <div class="col-md-6">
          <!-- Input field for search query -->
          <%= f.text_field :query, value: params[:query], placeholder: "Enter name or description", class: "form-control border-dark shadow-sm" %>
        </div>
        <div class="col-auto">
          <!-- Search button -->
          <%= f.submit "Search", class: "btn btn-dark shadow-sm" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Search Results -->
  <% if params[:query].present? %>
    <h5 class="text-success">
      <!-- Display the number of results -->
      <%= @plans.size %> match<%= @plans.size > 1 ? 'es were' : ' was' %> found for "<%= params[:query] %>". 
      <%= link_to 'Back', plans_path, class: 'btn btn-secondary btn-sm ms-2 shadow-sm' %>
    </h5>
  <% end %>

  <!-- Button to Create a New Plan -->
  <div class="d-flex justify-content-end mb-3">
    <%= link_to 'Create a New Plan', new_plan_path, class: 'btn btn-success btn-lg shadow-sm animate-fade' %>
  </div>

  <!-- List of Plans -->
  <div class="list-group">
    <% if @plans.any? %>
      <% @plans.each do |plan| %>
        <div class="list-group-item shadow-sm mb-3 animate-fade">
          <!-- Plan details -->
          <h5 class="text-dark fw-bold"><strong>Plan Name:</strong> <%= plan.name %></h5>
          <p><strong>Description:</strong> <%= plan.description %></p>
          <p>
            <p><strong>Start Time:</strong> <%= plan.start_time %><br>
            <strong>End Time:</strong>  <%= plan.end_time %>
          </p>
          <strong>Reference Plan:</strong>
          <!-- Read-only textarea to display reference plan -->
          <textarea class="form-control mb-2 border-dark shadow-sm" rows="2" readonly>
            <%= plan.reference_plan || "Not yet generated" %>
          </textarea>
          <!-- Edit and Delete buttons -->
          <div class="d-flex">
            <%= link_to 'Edit', edit_plan_path(plan), class: 'btn btn-primary btn-sm shadow-sm me-2', style: "width: 120px;" %>
            <%= button_to 'Delete', plan_path(plan), method: :delete, data: { confirm: 'Are you sure to delete?' }, class: 'btn btn-danger btn-sm shadow-sm', style: "width: 120px;" %>
          </div>
        </div>
      <% end %>
    <% else %>
      <!-- Message displayed if no plans are found -->
      <div class="alert alert-warning shadow-sm animate-fade" role="alert">
        No plans found. Create one now!
      </div>
    <% end %>
  </div>
</div>
